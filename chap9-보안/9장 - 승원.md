# 9장

# 보안의 개념과 정의

보안은 “사고 없는 상태를 유지하는 모든 활동”을 뜻한다. 물리적, 산업적, 군사적 등등 많지만 IT 분야의 정보 보안을 알아보자

### 정보 보안

정보 보안은 크게 정보가 외부에서 유출되는 것을 막거나, 내부에서 유출되는 것을 막는 두가지로 나뉜다.

보안의 필수 요소

- 기밀성 - 인가되지 않은 사용자가 정보를 보지 못하게 하는 모든 작업
- 무결성 - 정확하고 완벽한 정보 유지에 필요한 모든 작업
- 가용성 - 필요할 때 접근을 허락하는 일련의 작업

네트워크 정보 보안이란 1차 목표는 서비스에 대한 공격을 막는 것이고, 2차 목표는 유출을 막는 것이다.

### 네트워크 보안의 주요 개념

네트워크 보안의 목표는 외부 네트워크로부터 내부 네트워크를 보호하는 것이다.

- Trust 네트워크 - 외부로부터 보호해야 할 네트워크
- Untrust 네트워크 - 신뢰할 수 없는 네트워크
- DMZ 네트워크 - 신뢰할 수 없는 외부 사용자에게 개방해야 하는 서비스
    - 인터넷 시큐어 게이트웨이 - 네트워크에서 Untrust 네트워크로의 통신을 통제 (SWG, WebFilter 등)
    
    ![image](https://github.com/Deep-Dive-Study/network-for-engineer/assets/85796588/201ac934-33da-4a3e-b336-e8e590e1a17a)
    
    - 데이터 센터 시큐어 게이트 웨이 - 언트러스트 네트워크에서 Trust/DMZ로의 통신을 통제 (IPS, DCSG, WAF등)
    
    ![image](https://github.com/Deep-Dive-Study/network-for-engineer/assets/85796588/d25bab40-170b-4cca-ac87-47b71498fa7a)
    

네트워크에서 사용되는 요구사항에 따른 성능과 기능이 다르기 때문에, 사용되는 목적에 따라 서비스나 장비가 달라진다.

**네트워크 보안 정책**

- 화이트리스트
    
    방어에 문제가 없다고 명확히 판단되는 통신만 허용하는 방식이다.
    
- 블랙리스트
    
    공격이라고 명확히 판단되거나 문제가 있었던 IP 또는 패킷 리스트를 기반으로 DB를 만들어 그 정보를 이용해 방어하는 형태이다.
    
- 하이브리드
    
    잘 아는 IP에 대해서 열어두고, 나머지 주소는 블랙리스트 기반으로 운영한다.
    

**탐지 에러 타입**

- 정탐
    
    추론한 내용과 같은 결과로 나온 경우
    
- 오탐
    
    공격이라 추론 했는데 공격이 아닌 경우 
    
- 미탐
    
    공격이 아니라고 추론 했는데 공격인 경우
    

# 보안 솔루션의 종류

보안 솔루션 마다 방어 가능한 범위가 다르다.

![image](https://github.com/Deep-Dive-Study/network-for-engineer/assets/85796588/3fde77dd-9119-45e3-bdd6-c9883393a8f5)

다음과 같이 DDoS - 방화벽 - IPS - WAF과 같이 여러 단계의 솔루션이 존재한다.

### DDos 방어 장비

DoS(Denial of Service) - 다양한 방법으로 공격 목표에 부하를 가해는 공격 기법

DoS의 경우 비교적 탐지가 쉽고 IP 기반으로 방어할 수 있다.

탐지를 회피하고 더 짧은 시간 안에 공격 성과를 위해 다수의 봇을 이용해 분산 공격 하는 DDoS 기법이 등장했다.

DDoS 공격은 IDC 네트워크 내부와 외부 경계에서 방어하는데 이는 볼류메트릭 공격을 막기 위함이다.

볼류메트릭 - 회선 사용량이나 그 이상의 트래픽을 과도하게 발생시켜 회선 사용을 방해하는 공격.

### 방화벽

4계층에서 동작하는 패킷 필터링 장비이다. 일반적으로 DDoS 방어 장비 바로 뒤에 놓이며, 간단하고 성능이 우수하다.

3, 4 계층 정보를 기반으로 정책을 세울 수 있고, 정책에 맞는 패킷을 허용하거나 거부한다.

### IDS, IPS

IDS(Intrusion Detection System) - 침입 탐지 시스템

IPS(Intrusion Prevention System) - 침입 방지 시스템

### WAF(Web Application Firewall)

웹 서버를 보호하는 장비로 HTTP, HTTPS 처럼 웹 프로토콜의 공격을 방어한다.

IDS/IPS 보다 범용성이 떨어지지만 웹 프로토콜에 대해서 더 세밀히 방어할 수 있다.

WAF는 프록시 서버처럼 패킷을 데이터 형태로 조합해 처리해서 회피 공격을 방어할 수 있다.

### 샌드박스

해커는 직접적으로 공격하지 않고 악성 코드를 관리자 PC에 심어 감염 시키는 방식으로 변했다.

이런 공격들이 발전해 APT, ATA 공격이 되었는데 샌드박스는 APT를 방어하는 대표적인 장비이다.

### NAC(Network Access Control)

네트워크에 접속할 때 인가된 사용자만 접속할 수 있도록 한다.

### IP 제어

NAC 비슷하지만, 금융권에서 고정IP 사용을 해야 하는데, 이때 할당된 IP가 아니면 사용하지 못하도록 한다.

### 접근 통제

서버나 DB에 대한 직접적인 접근을 막고, 추적 및 감사를 할 수 있는 솔루션 이다.

서버 접근을 위한 모든 통신은 베스천 호스트를 통해서만 하고 다른곳에서 보낸 요청은 모두 방어하도록 한다.

### VPN

사용자 기반의 VPN 서비스를 제공해주는 장비

# 방화벽

네트워크 중간에서 통과하는 트래픽을 주어진 정책에 맞추어 허용/차단 하는 장비

### 방화벽의 진화

- 초기 방화벽(패킷 필터 방화벽)
    
    장비에 등록된 정책만으로 단순히 패킷을 필터링했다.
    
- 현대 방화벽(상태 기반 방화벽)
    
    순수 정책으로 해결되지 않는 문제들이 발생해 SPI 엔진이 나오게 되었다.
    
    SPI 엔진은 패킷의 인과 관계와 방향성을 인지해 정책을 적용할 수 있다.
    

### 방화벽 동작방식

![image](https://github.com/Deep-Dive-Study/network-for-engineer/assets/85796588/f7879b33-1c8f-4265-a5f4-6d9ab330de05)

1. 세션 테이블 확인
    1. 있다면 2로
    2. 없다면 3으로
2. 포워딩 테이블 확인
    1. 있다면 패킷 포워딩
    2. 없다면 패킷 폐기
3. 방화벽 정책 확인
    1. 있다면 4로
    2. 없다면 패킷 차단
4. 세션 테이블에 기록 후 2번으로

SPI 엔진은 단순히 튜블 조건만 확인하는게 아니라 3, 4 계층의 세부적인 필드도 함께 확인한다. 따라서, 세션 탈취 공격의 일부를 방어할 수 있고, 세션 테이블에 로깅하기 좋다.

### ALG(Application Layer Gateway)

고대의 프로토콜은 방화벽 같은 세션 장비를 고려하지 못해 정상적인 통신이 불가능한 경우가 있다. (FTP)

ALG는 애플리케이션 프로토콜을 확인하고 포트를 자동으로 열어준다.

ALG가 모든 프로토콜에 맞추어 제작되지 않기 때문에 NAT나 STUN같은 기술들이 생겨 많이 사용한다.

### 방화벽의 한계

- 3, 4 계층에서만 동작한다.
- DDoS나, 바이러스 같은 공격에 취약하다.

# IPS, IDS

방화벽보다 더 넓은 영역에서 검사한다.(3~7 계층)

IDS - 방어보다 탐지에 초점을 맞추어 트래픽을 복제해 침입 여부를 판별한다.

IPS - 발견된 공격을 직접 차단하는 장비이다.

![image](https://github.com/Deep-Dive-Study/network-for-engineer/assets/85796588/cd8fddb7-01b2-41cc-97af-ee91c4aa1df3)

### 동작 방식

공격 데이터베이스를 사용한 패턴 매칭 방식으로 운영되지만 프로토콜/프로파일 어노말리 등의 기법으로 공격을 방어한다.

- 패턴 매칭 방식
    
    기존 공격 방식이나 취약점을 통해 데이터베이스를 습득하고 유지하다가 공격을 파악하는 패턴 방식, 최신 공격 패턴을 반영하는 것이 중요하다.
    
- 어노말리 공격 방어
    
    패턴 기반의 방어는 극미한 변화만 생겨도 적절한 대응이 어려웠다. 어노말리 기법은 특정 기준 이상의 행위를 이상하다고 판단하고 방어한다.
    
    - 프로파일 어노말리
        
        평소와 다르게 트래픽이 발생하는 경우 제어한다.
        
    - 프로토콜 어노말리
        
        감염된 내부 PC가 외부와 공격을 위해 통신을 할 때 의심이 가는 행위를 파악해 제어하는 기법이다.
        

### IPC, IDS의 한계와 극복방법

IPS는 우회하기 쉽고, 오탐이 자주 발생하기 때문에 최적화 작업을 지속적으로 수행해야 된다. 최근에는 이를 해결한 NGIPS 장비가 출시되어 이 문제를 해결하고 있다.

# DDoS 방어 장비

방화벽의 탄생으로 인해 DoS와 DDoS 공격이 생겼다. 서버에 트래픽을 몰리게 하여 정상적인 서비스를 할 수 없게 하는 방식이다.

### DDoS 방어란

볼류메트릭 공격을 방어하기 위해 트래픽 프로파일링 기법을 사용하고, 인터넷의 다양한 공격 정보를 수집해 데이터베이스로 활용하기도 한다.

### DDoS 방어 장비 동작 방식

DDoS 공격을 탐지해 공격을 수행하는 IP 리스트를 넘겨줘 ISP 장비에서 IP를 버리는 방법이 가장 흔하다.

DDoS 여부를 판별하는 방법은 데이터베이스 방법과 프로토콜별 사용량을 저장하고, 과도한 트래픽이 인입되면 알려주고 차단한다.

### DDoS 공격 타입

- 볼류메트릭 공격
    
    대용량 트래픽으로 네트워크 대역폭을 포화시킨다. (NTP/DNS 증폭, UDP/TCP 플러드)
    
- 프로토콜 공격
    
    3, 4 계층 프로토콜 스택의 취약점을 이용해 대상을 액세스할 수 없게 한다. 공격 대상의 리소스를 고갈시킨다. (Syn 플러드, PoD)
    
- 애플리케이션 공격
    
    7계층 프로토콜 약점을 악용하는 공격. 대상과의 연결을 설정한 후 프로세스와 트랜잭션을 독점해 서버 자원을 소모시킨다. (HTTP 플러드, DNS 서비스 공격, Slowloris)
    

# VPN

공중망을 이용해 논리적으로 직접 연결한 것처럼 망을 구성하는 기술. (터널링)

터널링을 사용하는 경우 강력한 보안을 제공해야 하기 떄문에 IPSEC, SSL 같은 암호화 기법을 제공한다.

VPN은 IP를 우회하는데도 사용하지만, 보안을 위해서도 사용한다. 데이터를 암호화하고 외부에서 패킷을 확인할 수 없기 때문이다.

### VPN 동작 방식

- Host to Host
    
    두 호스트 간에 직접 VPN 터널을 연동하는 기법. 잘 사용되지 않는다.
    
- Network to Network
    
    본사-지사 같은 특정 네트워크를 연결하는 경우
    
- Host가 Network 접근할 때 보호
    
    모바일 사용자가 일반 인터넷망을 통해 사내망으로 연결하는 경우
