# 3장 네트워크 통신하기

## 3.1 유니캐스트, 멀티캐스트, 브로드캐스트, 애니캐스트

- 네트워크에서 출발지에서 목적지로 데이터를 전송할 때 사용하는 **통신 방식**

#### 유니캐스트(Unicast)

- `1 : 1 통신`

- 출발지와 목적지가 1 : 1로 통신함

- 실제로 사용하는 대부분의 통신 방식 

![image](https://github.com/Deep-Dive-Study/network-for-engineer/assets/99165624/2625fdeb-f049-432b-93c0-5e6e58a444e2)

#### 브로드캐스트(Broadcast)

- `1 : 모든 통신`
  
- 동일 네트워크에 존재하는 모든 호스트가 목적지(모든 호스트에 패킷 전달)
  
- 상대방의 정확한 위치를 알기 위해 사용

![image](https://github.com/Deep-Dive-Study/network-for-engineer/assets/99165624/a96f2aad-e43e-446a-85ab-228d30fd7fc9)

#### 멀티캐스트(Multicast)

- `1 : 그룹 (멀티캐스트 구독 호스트) 통신`
  
- 하나의 출발지에서 다수의 특정 목적지로 데이터 전송
  
- 단방향으로 다수에게 동시에 같은 내용 전달 시 사용 ex) IPTV, 실시간 방송, 등

![image](https://github.com/Deep-Dive-Study/network-for-engineer/assets/99165624/d294042f-4715-4473-b68e-8583b2271d33)

#### 애니캐스트(Anycast)

- `1 : 1 통신(목적지는 동일 그룹 내의 1개 호스트)`
  
- 다수의 동일 그룹 중 가장 가까운 호스트에서 응답
  
- IPv4에서는 일부 기능 구현, IPv6은 모두 구현 가능
  
- 가장 가까운 DNS 서버 찾을 때, 가장 가까운 게이트웨이 찾을 때 사용

- 최초 통신은 유니캐스트와 동일하지만 통신할 수 있는 후보자가 다름(동일 목적지 주소를 가진 서버가 여러개 있음)

![image](https://github.com/Deep-Dive-Study/network-for-engineer/assets/99165624/7ca6fc11-5b8c-4874-b7d4-018fe6e2b106)

#### 통신 방식 정리

![image](https://github.com/Deep-Dive-Study/network-for-engineer/assets/99165624/a7581e54-1368-4ab0-95af-42a25f63e1f0)

- 통신 방식을 구분할 때 출발지가 아닌 목적지 주소를 기준으로 구분함

#### BUM 트래픽

- B(Broadcast), U(Unknown Unicast), M(Multicast) 을 지칭하는 용어
  
  - `Unknown Unicast`(언노운 유니캐스트) : 목적지 주소는 명확히 명시되어 있지만 네트워크에서의 동작은 브로드캐스트와 같을 때

    - 유니캐스트이지만 실제로 겉으로 보이는 동작 방식은 브로드캐스트에 가까움

    - 스위치가 목적지에 대한 주소를 학습하지 못한 상황에 발생(스위치입장에서 Unknown)

    - 스위치가 목적지 정보를 모르기 때문에 모든 포트로 플러딩(전송)함 

    ![image](https://github.com/Deep-Dive-Study/network-for-engineer/assets/99165624/19d2cbec-8ef8-4a93-b39d-639830125a84)

- 전달받는 모든 단말 NIC에서 도착지 주소를 확인하고 자신이 목적지가 아니므로 패킷을 버림

- **불필요한 BUM 트래픽이 많아지면 네트워크 성능이 저하**(불필요한 네트워크 자원을 소모)

- 이더넷 환경에서는 ARP 브로드캐스트를 먼저 보내고 통신하기 때문에 BUM 트래픽이 많이 발생하지 않음

## 3.2 MAC 주소

- Media Access Control의 줄임말
  
- 2계층(데이터 링크 계층)에서 통신을 위해 네트워크 인터페이스에 할당된 **고유 식별자**
  
- 이더넷과 와이파이를 포함한 대부분의 IEEE 802 네트워크 기술에서 2계층 주소로 사용(물리적인 주소)

### 3.2.1 MAC 주소 체계

- 변경할 수 없도록 하드웨어에 고정되어 출하됨
  
- 네트워크 구성 요소마다 다른 주소 보유

- `제조사 코드(Vendor Code)` : 네트워크 장비 제조업체에 주소 풀을 할당하는 것 (IEEE가 관리)
  
- 48비트의 16진수 12자리로 표현
  
    - **앞의 24비트** : 제조사 코드, OUI(Organizational Unique Identifier)
      
    - **뒤의 24비트** : 각 제조사에서 자체적으로 할당(네트워크에서 각 장비 구분), UAA(Universally Administered Address)
      
- BIA(Burned-In Address) : 제조사에서 장비를 생산할 때 하드웨어적으로 정해짐 

#### 유일하지 않은 MAC 주소

- 간혹 MAC 주소가 유일하지 않을 수 있음

- 제조업체 코드 내에서 뒤의 24비트의 UAA 값을 할당 → 실수나 의도적으로 MAC 중복 발생
  
- **동일 네트워크에서만 중복되지 않으면 동작하는 데 문제 없음**

- 라우터에서 다른 네트워크로 넘겨줄 때 출발지와 도착지의 MAC 주소 변경 → **네트워크를 넘어가면 기존 출발지와 도착지 MAC 주소 유지 X**

#### MAC 주소 변경

- 결국 MAC 주소도 메모리에 적재되어 구동되기 때문에 변경이 가능함

- 운영체제 별로 다를 수 있으나 명령어나 설정 파일 변경만으로 변경 가능 


### 3.2.2 MAC 주소 동작

- 자신의 MAC 주소를 가지고 있는 전기 신호가 들어오면 2계층에서 데이터 형태(패킷)로 변환 → 내용 구분 후 도착지 MAC 주소 확인
  
- 도착지 MAC 주소가 자신이 갖고 있는 MAC 주소와 다름 → 해당 패킷 폐기 처리
  
- 패킷의 목적지 주소가 자기 자신이거나 브로드캐스트, 멀티캐스트와 같은 그룹 주소 → 처리해야 할 주소로 인지, 패킷을 **상위 계층으로 전달**

![image](https://github.com/Deep-Dive-Study/network-for-engineer/assets/99165624/c920ffee-bd5c-4e3e-b36d-d0f5c1cba303)

#### 무차별 모드(Promicuous Mode)

- 자신의 MAC 주소와 일치하지 않는 도착지 주소를 가짐 → 자체적으로 폐기
  
- 다른 목적지를 가진 패킷을 분석하거나 수집 → 무차별 모드로 NIC 구성
  
- 자신의 MAC 주소와 상관없는 패킷이 들어와도 이를 분석할 수 있도록 메모리에 올려 처리

- 대표적으로 와이어샤크(Wireshark)가 있음

#### MAC 주소를 여러 개 갖는 경우

- MAC 주소는 단말이 아닌 NIC에 종속 → NIC가 여러개라면 MAC 주소도 여러개 가질 수 있음

- 멀티 레이어 스위치, 라우터, 같은 복잡한 네트워크 장비는 여러개 가지고 있음

## 3.3 IP 주소

- 2계층 : `물리 주소`인 MAC 주소 사용
  
- 3계층 : `논리 주소`인 IP 주소 사용
  
- 사용자가 **변경 가능한** 논리 주소
  
- 주소에 레벨 보유, 그룹을 의미하는 `네트워크 주소`, `호스트 주소`

### 3.3.1 IP 주소 체계

- IPv4(32비트, 주로 사용), IPv6(128비트)
  
- 4개의 옥텟(8비트 단위), 각 옥텟은 `.` 로 구분

- 2계층은 16진수로 표기한된 것과 달리 10진수로 표기(8비트 옥탯은 `0 ~ 255` 값을 가짐) 

![image](https://github.com/Deep-Dive-Study/network-for-engineer/assets/99165624/14ddb3cf-8f86-4501-8531-d767aa6994ec)

- 3계층 IP주소도 `네트워크 주소`와 `호스트 주소` 두 부분으로 나뉨

  - **`네트워크 주소`** : 호스트들을 모은 네트워크를 지칭하는 주소, 네트워크 주소가 동일한 로컬 네트워크
    
  - **`호스트 주소`** : 하나의 네트워크 내에 존재하는 호스트를 구분하기 위한 주소
  
- 네트워크 주소와 호스트 주소의 구분하는 **`경계점 고정 X`**

  - 다른 주소 체계와는 다른 큰 특징 중 하나 
  
- 필요한 호스트 IP 개수에 따라 네트워크의 크기를 다르게 할당할 수 있는 `클래스` 개념 도입
  
  - A 클래스(약 1600만 개, 첫 번째 옥텟에 구분자)
    
    - 첫 옥텟이 **0** 0000000 ~ **0** 1111111인 주소

      - 2진수 8자리 중 맨 앞자리가 0인 주소 
      
    - 127만 예외로 루프백 주소(자신 의미)
      
    - 1.0.0.0 ~ 126.255.255.255

    - 네트워크 주소를 표현하는 부분이 1개의 옥텟, 호스트 주소를 나타내는 부분이 3개의 옥텟

      - 즉, 2^8 → 256개의 네트워크와

      - 2^8^3 → 2^24 → 16,777,216개의 호스트 주소(1개의 네트워크에서 가질 수 있는 호스트 수)를 가질 수 있음 
      
  - B 클래스(약 6만 5천 개, 두 번째 옥텟에 구분자)
    
    - 첫 옥텟이 **10** 000000 ~ **10** 111111인 주소

      - 2진수 8자리 중 맨 앞자리가 1인 주소(그 다음 자리는 0)
      
    - 128.0.0.0 ~ 191.255.255.255

    - 네트워크 주소를 표현하는 부분이 2개의 옥텟, 호스트 주소를 나타내는 부분이 2개의 옥텟
    
      - 2^8^2 → 65,536개의 네트워크와 2^16 → 65,536개의 호스트 주소를 가질 수 있음 
      
  - C 클래스(약 250개, 세 번째 옥텟에 구분자)
    
    - 첫 옥텟이 **110** 00000 ~ **110** 11111인 주소
      
    - 192.0.0.0 ~ 223.255.255.255
      
  - D 클래스 : 멀티캐스트(Multicast)
    
    - 224.0.0.0 ~ 239.0.0.0
      
  - E 클래스 : 예약(Reserved for futures)
    
- 다른 고정된 네트워크 주소 체계에 비해 주소 절약 가능(유연함)

- 각 클래스마다 구분자 위치가 다름, 구분자를 `서브넷 마스크`라고 함

- 과거에 사용되던 개념으로 **`현재에는 사용되지 않고 있음!`**

![image](https://github.com/Deep-Dive-Study/network-for-engineer/assets/99165624/eefbc284-9870-4de0-847a-1b5d60358401)

![image](https://github.com/Deep-Dive-Study/network-for-engineer/assets/99165624/082c7f1b-ccf3-4dce-9110-ddca6dff52c0)

#### 네트워크에서 사용 가능한 호스트 개수 파악하기

![image](https://github.com/Deep-Dive-Study/network-for-engineer/assets/99165624/d6d2dc07-33a5-4bea-9df8-e4d9bdd07b3a)

- IP는 2진수로 나타내므로 2^자리수 형태로 표현할 수 있는 IP 숫자를 구할 수 있음
  
- 한 네트워크에서 맨 앞의 숫자는 네트워크 주소로 사용되고, 맨 뒤의 숫자는 브로드캐스트 주소로 사용됨

  - 실질적으로 사용 가능한 호스트의 수는 두개를 제외한 값 

### 3.3.2 클래스풀과 클래스리스

- 클래스풀(Classful) : 클래스 기반의 IP 주소 체계
  
  - 네트워크 주소와 호스트 주소를 구분짓는 구분자(서브넷 마스크)가 불필요

#### 3.3.2.1 클래스리스 네트워크의 등장

- IP 주소가 기하급수적으로 증가 → 효율적인 사용 방안 혹은 대책이 필요

**`3가지 보존,전환전략`**

- **`단기 대책`** : 클래스리스, CIDR(Classless Inter-Domain Routing)
  
- **`중기 대책`** : NAT와 사설 IP 주소
  
- **`장기 대책`** : 차세대 IP인 IPv6
  
- IPv4의 문제 → 할당받은 조직에서 이 주소들을 제대로 사용하지 못하면서 낭비하는 것

  - 이 문제를 해결하기 위해, 클래스 개념 자체를 버림

  - 별도로 네트워크와 호스트 주소를 나누는 구분자가 필요함
  
- **`서브넷 마스크(Subnet Mask)`** : 네트워크와 호스트 주소를 나누는 구분자
    
    - 숫자 1은 네트워크 주소, 0은 호스트 주소로 표시
      
    - 255는 네트워크 주소 부분, 0은 호스트 주소 부분
    
    - 2진수의 `and 연산`으로 네트워크 주소만 분리 가능 

![image](https://github.com/Deep-Dive-Study/network-for-engineer/assets/99165624/7a24c6b0-a9a5-4ffe-a9df-74d3863d8be8)

![image](https://github.com/Deep-Dive-Study/network-for-engineer/assets/99165624/59106c03-516f-4ad1-8cbf-ed04f8180f37)

- 클래스리스 기반의 IP 네트워크를 표현하는데 반드시 서브넷 마스크가 필요함

- 서버나 PC에 IP 주소를 부여할 때도 사용됨

![image](https://github.com/Deep-Dive-Study/network-for-engineer/assets/99165624/09bebeed-74ea-4359-b992-45b407ad7f76)

#### 서브넷 마스크 표현 방법

- `비트 단위로 표현하는 방법`, `10진수로 표현하는 방법`

  - `비트 단위` : /8(A클래스), /16(B클래스), /24(C클래스)

  - `10진수` : 255.0.0.0(A클래스), 255.255.0.0(B클래스), 255.255.255.0(C클래스)

### 3.3.3 서브네팅(Subnetting)

- 원래 부여된 클래스의 기준을 무시하고 새로운 네트워크-호스트 구분 기준을 사용자가 정해 원래 클래스풀 단위의 네트워크보다 더 쪼개 사용하는 것

  - 2진수의 1비트 단위로 네트워크를 분할

![image](https://github.com/Deep-Dive-Study/network-for-engineer/assets/99165624/7d7b0922-f329-414f-ac9d-397e8b7c3c77)

- 실무에서 서브네팅을 고민해야 하는 두 가지 경우

  - 네트워크 디자인 단계에서 네트워크 설계자가 네트워크를 효율적으로 어떻게 분할할 것인지 계획
  
  - 이미 분할된 네트워크에서 사용자가 자신의 네트워크와 원격지 네트워크 구분

- `네트워크 사용자 입장`
    
    - 네트워크에서 사용할 수 있는 IP 범위 파악
    
    - 기본 게이트웨이와 서브넷 마스크 설정이 제대로 되어 있는지 확인

- `네트워크 설계자 입장`
    
    - 네트워크 설계 시 네트워크 내에 필요한 단말을 고려한 네트워크 범위 설계

#### 3.3.3.1 네트워크 사용자의 서브네팅

- 자신이 속한 네트워크의 유효 범위를 파악 해야 함

  - 잘못 하면 통신에 문제가 발생

  - 비트 단위로 분할 되어 있는 경우 파악이 어려움.. 

![image](https://github.com/Deep-Dive-Study/network-for-engineer/assets/99165624/67023877-263f-4e19-8744-e670180b8d33)

`자신이 속한 네트워크의 유효 범위를 파악하는 방법`

- 내 IP를 2진수로 표현
- 서브넷 마스크를 2진수로 표현
- 2진수 AND 연산으로 서브네팅된 네트워크 주소 알아내기
- 호스트 주소 부분을 2진수 1로 모두 변경해 브로드캐스트 주소 알아내기
- 유효 IP 범위 파악, 서브네팅된 네트워크 주소 + 1(유효 IP 중 가장 작은 IP)
- 브로드캐스트 주소 - 1(유효 IP 중 가장 큰 IP)
- 2진수로 연산되어 있는 결괏값을 10진수로 변환

**`좀 더 쉽게 서브네팅하고 자신이 속한 네트워크 범위 파악하는 방법`**

![image](https://github.com/Deep-Dive-Study/network-for-engineer/assets/99165624/ce730354-77cc-4bc7-8335-6129a34a9928)

- 서브넷 마스크를 2진수로 변환
  
- 현재의 서브넷이 가질 수 있는 최대 IP 개수 크기 파악(2^6=64)
  
- 64의 배수로 나열하여 기준이 되는 네트워크 주소 파악
    
    - 첫 블록은 0부터 시작
    
    - 각 네트워크의 마지막 주소가 브로드캐스트 주소
    
    - 다음 블록 네트워크 주소의 -1 수
    
    - 0 ~ 63 / 64 ~ 127 / 128 ~ 191 / 192 ~ 255
      
- IP 주소에서 호스트 주소가 속한 네트워크 선택

- 필요한 주소 정리(네트워크 주소, 브로드캐스트 주소, 유효 IP 범위)

- 서브넷 마스크를 중심으로 네트워크 크기를 파악해 서브넷된 네트워크의 크기를 알아내는 것이 중요

#### 3.3.3.2 네트워크 설계자 입장

- 사용자와 반대로 서브넷 마스크를 결정하고 설계에 반영해야 하는 입장

- **`고민해야 할 점`**

  - 서브넷된 하나의 네트워크에 IP를 몇 개나 할당해야 하는가?(또는 PC는 몇 대나 있는가?)
  
  - 서브넷된 네트워크가 몇 개나 필요한가?

- 네트워크를 잘 설계하면 관리하기 쉽고 네트워크 장비 성능도 향상됨
  
  - 설계할 때 사설 IP 대역을 사용하여 충분한 IP 대역을 사용할 것을 권장

### 3.3.4 공인 IP와 사설 IP

- **`공인 IP`** : 전 세계에서 유일한 식별자

  - 통신사업자로부터 할당받거나 KISA(한국)와 같은 IP할당 기관에서 인터넷 독립기관 주소를 할당받은 후 독립 IP을 할당받아야 함(복잡)

- **`사설 IP`** : 인터넷에 연결하지 않고 개인적으로 네트워크 구성시 사용하는 주소
    
    - `NAT` 기술을 사용할 경우 인터넷 접속 가능

      - 사설 IP를 공인 IP로 변환하는 기술 (장비 ex) 공유기)

      - [NAT에 좀 더 알고 싶다면](http://www.ktword.co.kr/test/view/view.php?no=1676)
   
    - A 클래스 1개, B 클래스 16개, C 클래스 256개 사용 가능(사용 가능한 영역이 RFC에 명시되어 있음)

    - ![image](https://github.com/Deep-Dive-Study/network-for-engineer/assets/99165624/2e5d3903-618e-433d-a0ca-7a145a3194e8)

#### 사설 네트워크 구축시 주의사항

- 다른 사용자에게 할당된 IP를 사설 네트워크 주소로 사용하면 안됨

  - RFC에 명시된 사설 IP 대역을 사용할 것을 권장(인터넷 어느 구간에서도 사용하지 않는 구간) 

- 같은 네트워크 인식하여 정상적인 통신이 불가능해짐

  - 즉, 다른 주소임에도 같은 네트워크 주소로 착각하여 전달되지 못함
     
![image](https://github.com/Deep-Dive-Study/network-for-engineer/assets/99165624/4dfd11b9-8f94-4f9d-a197-4f2ed2537303)

#### Bogon IP

- IP주소를 관리하는 최상위 기구인 IANA가 **여러가지 목적으로 예약해놓아 공인 IP로 할당되지 않는 주소** (특수 목적 IP)

![image](https://github.com/Deep-Dive-Study/network-for-engineer/assets/99165624/8e957fb1-5382-4bbf-8427-eeb4b4eb2e5f)
